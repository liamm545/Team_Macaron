#include <Car_Library.h>

int val;  // 수신될 가변 저항 값 저장할 변수

int stop_; // 신호등 만났을 때

#define NUM_SENSORS 6  // Define the number of sensors

// 초음파 pin
int trigPins[NUM_SENSORS] = {50, 48, 46, 44, 34, 32};  //정면, 우측 정면, 우측 옆면, 후면, 좌측 옆면, 좌측 정면
int echoPins[NUM_SENSORS] = {51, 49, 47, 45 ,35, 33};  //정면, 우측 정면, 우측 옆면, 후면, 좌측 옆면, 좌측 정면

int motor_left_1 = 2;  //왼쪽 뒷바퀴
int motor_left_2 = 3;

int motor_right_1 = 4;  //오른쪽 뒷바퀴
int motor_right_2 = 5;

int motor_steer_1 = 6;  // 앞바퀴 조향
int motor_steer_2 = 7;

int analogPin = A5;  //가변 저항

// Define name of the pins
const char* Strings[NUM_SENSORS] = {"정면", "우측 정면", "우측 옆면", "후면", "좌측 옆면", "좌측 정면"};

long distances[NUM_SENSORS];

void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);
  
  for (int i = 0; i < NUM_SENSORS; i++) {
    pinMode(trigPins[i], OUTPUT);
    pinMode(echoPins[i], INPUT);
  }

  pinMode(motor_left_1, OUTPUT);
  pinMode(motor_left_2, OUTPUT);
  pinMode(motor_right_1, OUTPUT);
  pinMode(motor_right_2, OUTPUT);
  pinMode(motor_steer_1, OUTPUT);
  pinMode(motor_steer_2, OUTPUT);
}

void loop() {
  stop_ = 0
  //신호등 만났을 때는 멈춰야 됨.
  if(stop_ == 1){  //멈추는 조건. 이거는 
    motor_hold(motorA1, motorA2);
    delay(3000);  //몇 초 멈춰야 하는지.
    stop_ == 0; // 이제는 신호등 없으니까 0으로 만들어줌.
  }
  //신호등 부분 제외하고 직진은 계속 해야하므로, delay 아주 작게 줘서 계속 뒷바퀴는 움직이도록 한다.
  motor_forward(motor_right_1, motor_right_2, 150);
  motor_backward(motor_left_1, motor_left_2, 150);
  delay(10);  
  
  // 조향 부분. 저항값을 받아와서 조향을 하는 거 같음.
  if(Serial.available()) {
    val = Serial.parseInt();
   
    // 가변 저항 값에 따라 조향 각도 계산
    int angle = map(val, 123, 153, -70, 70); //좌우 각도를 계산해서 val 값을 기준으로 mapping 해줌.
    
    if(angle >= 0) //여기를 정해진 각도 값으로 해서 조향해야할 듯.
    {
      
    }
    else if(angle <= 0 && angle >= 0)
    {
      
    }
    else
    {
      
    }
      
  }

  motor_backward(motor_steer_1, motor_steer_2, 70);  //우회전
  motor_forward(motor_left_1, motor_left_2, 70); //좌회전

  //예를들어 중간이 120이라고 친다.
  // 측정할 것 : 1. 일단 최대 조향 각도
  // 2. motor_forward함수에서 숫자에 따라 조향되는 속도(시간재서)
  // 그래서 만약 val값이 125라면 적절한 속도로 조향되게.

  
}
